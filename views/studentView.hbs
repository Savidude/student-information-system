<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!--[if IE]>
    <script type="text/javascript">
        window.location="https://www.mozilla.org/firefox/download";
    </script>
    <![endif]-->

    <script>
        function getStudents(url, callback) {
            const xhr = new XMLHttpRequest();
            xhr.timeout = 2000;
            xhr.onreadystatechange = function(e) {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        callback(null, xhr.response)
                    } else {
                        callback(xhr.status, null)
                    }
                }
            };
            xhr.ontimeout = function () {
                console.log('Timeout')
            };
            xhr.open('get', url, true);
            xhr.send();
        }

        getStudents("/students", function (status, response) {
            const results = JSON.parse(response);

            results.forEach(function (student) {
               console.log(JSON.stringify(student));
               var studentRow = document.createElement("tr");

               var nameCell = document.createElement("td");
               nameCell.innerHTML = student.name;
               studentRow.appendChild(nameCell);

                var emailCell = document.createElement("td");
                emailCell.innerHTML = student.email;
                studentRow.appendChild(emailCell);


                var address = student.address;
                if (address !== undefined) {
                    var addressCell = document.createElement("td");
                    var addressText = address.line1 + ", " + address.line2 + ", " + address.state + ", " + address.zip;
                    addressCell.innerHTML = addressText;
                    studentRow.appendChild(addressCell);

                    var tableBody = document.getElementById("studentRecords");
                    tableBody.appendChild(studentRow);
                }
            });
        });
    </script>
</head>
<body>

<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Student Information System</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav">
                <li><a href="/">Home</a></li>
                <li class="active"><a href="/students/view">Students</a></li>
                <li><a href="#">Projects</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid text-center">
    <div class="row content">
        <div class="col-sm-8 text-left">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Email</th>
                        <th scope="col">Address</th>
                    </tr>
                </thead>
                <tbody id="studentRecords">
                    <!--<tr>-->
                        <!--<th scope="row">1</th>-->
                        <!--<td>Mark</td>-->
                        <!--<td>Otto</td>-->
                    <!--</tr>-->
                    <!--<tr>-->
                        <!--<th scope="row">2</th>-->
                        <!--<td>Jacob</td>-->
                        <!--<td>Thornton</td>-->
                    <!--</tr>-->
                    <!--<tr>-->
                        <!--<th scope="row">3</th>-->
                        <!--<td>Larry</td>-->
                        <!--<td>the Bird</td>-->
                    <!--</tr>-->
                </tbody>
            </table>
        </div>
    </div>
</div>

</body>
</html>